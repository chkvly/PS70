<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Seat Bidding System</title>
    <style>
        body {
            font-family: 'Consolas', monospace;
            background-color: #f5f5dc;
            padding: 20px;
        }
        h1 {
            font-size: 24px;
            font-weight: bold;
        }
        h2 {
            font-weight: bold;
        }
        p, ul, li {
            margin: 10px 0;
        }
        em {
            font-style: italic;
        }
        .fade-section {
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }
        img {
            max-width: 300px;
            height: auto;
        }
        .code-block {
            background-color: #f4f4f4;
            padding: 10px;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="fade-section">
        <h1>Real-Time Seat Bidding System</h1>
        <h2>Introduction</h2>
        <p>I developed a real-time seat bidding system that allows users to bid on available seats at a venue using their mobile devices. The project combines hardware components, such as an ESP32 C3 Dev Kit, OLED screen, push button, and photoresistor, with a user-friendly front-end webpage designed to resemble a mobile app on an iPhone. In addition, the system uses Firebase to store and synchronize real-time data on seat status, ensuring that all bids and seat availability updates are processed instantly to provide a seamless and dynamic user experience.</p>
        
        <h2>How It Works</h2>
        <ol>
            <li>A photoresistor is used to determine whether someone is sitting in a seat. When the photoresistor value falls below 800, it indicates that the seat is occupied. As soon as someone gets up from the seat and the photoresistor value rises above 800, the user is prompted via the OLED screen to make their seat available for bidding.</li>
            <li>The front-end webpage is designed as a mock-up of a real-time bidding mobile app on an iPhone, providing a user-friendly interface for the bidding process.</li>
            <li>If the user chooses to make their seat available for bidding, they press a button, which changes the seat status from "occupied" to "available for bidding." Firebase is used for storing and synchronizing real-time data on seat status.</li>
            <li>When a user seeking to bid clicks on an available seat, a confirmation modal appears.</li>
            <li>If the user confirms their intention to bid, the bid modal is displayed, allowing them to enter a bid amount. A 10-second timer is shown, indicating the time remaining to place a bid.</li>
            <li>If the user enters a bid amount greater than $0, the bidding process begins, and a 15-second bidding timer is displayed. During this time, simulated bids are generated to create a competitive bidding environment.</li>
            <li>After the bidding timer expires, the highest bid is confirmed, and the seat status is updated accordingly. The JavaScript code includes functions for displaying notifications to the user, such as when they have been outbid or when the bidding results are available.</li>
            <li>If the user wins the bid, a pop-up screen appears within the iPhone mockup, congratulating them on upgrading their seat. The user is instructed to show a QR code to a staff member to access their new seat. Scanning the QR code plays "Bullet with Butterfly Wings" by the Smashing Pumpkins.</li>
            <li>If the user is outbid, a pop-up screen informs them that they were not the highest bidder and provides the winning bid amount. The user is encouraged to scan a QR code to be notified when additional seats become available for bidding. Scanning this QR code plays George Costanza's answering machine message.</li>
        </ol>
        
        <h2>Technical Challenges and Solutions</h2>
        <h3>ESP32 Connectivity</h3>
        <p>Connectivity issues were experienced with different ESP32 models, including the ESP32 XIAO, WROOM, and C3 Dev Kit. These issues manifested as status 2 errors and port errors, indicating communication problems between the microcontroller and the development environment.</p>
        <p>Resolving these connectivity issues required persistence and a trial-and-error approach. Various troubleshooting techniques were employed, such as checking the wiring connections, ensuring the correct board selection in the Arduino IDE, and experimenting with different USB cables and ports. After numerous attempts and iterations, the ESP32 C3 Dev Kit was successfully connected and programmed.</p>
        
        <h3>OLED Screen Integration</h3>
        <p>Integrating the OLED screen with the ESP32 posed challenges in terms of controlling the on/off behavior based on the photoresistor readings. The OLED screen would turn off when the photoresistor value fell below a threshold, indicating seat occupancy, but it would not turn back on when the value rose above the threshold, signifying that the seat was vacated.</p>
        <p>To address this issue, the Arduino code was modified to include specific conditions and delays to ensure proper OLED screen functionality.</p>
        <p>The testdrawstyles function was modified to include a timeout period of 5 seconds, during which the system waits for a button press or checks if someone sits down again. If the button is pressed within the timeout period, the seat status is updated to "available" in the Firebase Realtime Database, and the OLED screen displays a confirmation message. If someone sits down during the timeout period, the OLED screen is cleared, and the function returns, keeping the seat status as "occupied."</p>
        
        <h3>PIR Sensor Considerations</h3>
        <p>Initially, a PIR sensor was considered for detecting the presence of a person in a seat. However, after experimenting with the PIR sensor, it was found to be overly sensitive and challenging to integrate with the ESP32. The PIR sensor's high sensitivity led to false triggers and inconsistent readings, making it difficult to reliably determine seat occupancy.</p>
        <p>As an alternative, a photoresistor was chosen for motion detection. The photoresistor provided a more stable and practical approach to detecting seat occupancy by measuring the ambient light level. By setting an appropriate threshold value, the system could accurately determine whether someone was sitting in a seat based on the changes in light intensity caused by their presence. The photoresistor proved to be a more reliable and easier-to-integrate solution compared to the PIR sensor.</p>
        
        <h3>Front-end Development</h3>
        <p>Developing the front-end webpage using HTML, CSS, and JavaScript required extensive trial and error to achieve the desired functionality and visual appearance. One of the main challenges was creating the pop-up boxes for placing bid amounts and displaying QR codes within the iPhone mockup. To address this, various CSS techniques were employed, such as absolute positioning, z-index layering, and responsive design principles. JavaScript code was written to dynamically create and manipulate the pop-up elements based on user interactions and bidding states.</p>
        
        <h3>Bidding Process Enhancement</h3>
        <p>To make the bidding process more engaging and realistic, effort was put into brainstorming and implementing features that would enhance the user experience. The goal was to create a sense of competition and urgency during the bidding phase.</p>
        <p>The solution involved generating randomly simulated bids within a specific time frame to determine a market-clearing price. JavaScript functions were developed to handle the simulated bids, update the seat status in real-time, and provide visual feedback to the user through the front-end interface.</p>
        
        <h2>Hardware Assembly and Enclosure</h2>
        <h3>Soldering</h3>
        <p>To ensure proper connections between the ESP32 C3 Dev Kit, OLED screen, push button, and photoresistor, precise soldering was required. Soldering the components involved carefully heating the pins and applying solder to create secure electrical connections. Proper soldering techniques, such as maintaining the correct temperature and using the appropriate amount of solder, were essential to ensure the reliability and functionality of the hardware setup.</p>
        
        <h3>3D Printed Enclosure</h3>
        <p>To protect the hardware components and provide a professional appearance, a custom enclosure was designed and 3D printed. The enclosure was obtained from Printables and modified using a heat gun to enlarge the holes for the wires. The 3D printed enclosure not only added aesthetic value to the project but also ensured the safe and secure housing of the components.</p>
        
        <h2>Concluding Remarks</h2>
        <p>The real-time seat bidding system showcases the integration of hardware components with a user-friendly front-end webpage to create an interactive and engaging bidding experience. By leveraging the capabilities of the ESP32 and Firebase Realtime Database, the system enables seamless communication between the physical world and the digital interface. Moreover, the project demonstrates the potential of real-time bidding systems in enhancing the user experience and maximizing revenue opportunities in event settings. With further refinement and scaling, this proof of concept could be adapted to real-world applications, revolutionizing the way people upgrade their seats and engage with live events.</p>

<h2>Code</h2> 
<h3>Arduino Code</h3> 
<pre class="code-block"><code>
    <div class="code-wrapper">

#include WiFi.h
#include FirebaseESP32.h
#include Wire.h
#include Adafruit_GFX.h
#include Adafruit_SSD1306.h

// Replace these with your Wi-Fi network settings
#define WIFI_SSID " "
#define WIFI_PASSWORD " "

// Firebase project credentials
#define FIREBASE_HOST " "
#define FIREBASE_AUTH " "

// Define the GPIO pins for the buttons (ESP32-C3 pins)
const int buttonPins[] = {18, 1, 2, 3};
const String seatIds[] = {"seat1", "seat2", "seat3", "seat4"};

// Define the analog pin for the photoresistor
const int photoresistorPin = A0;

// Define the threshold value for detecting if someone is sitting or has gotten up
const int sittingThreshold = 800;

#define I2C_SDA 4  // Use GPIO 4 for I2C SDA
#define I2C_SCL 5  // Use GPIO 5 for I2C SCL

TwoWire I2C_screen = TwoWire(0);

#define SCREEN_WIDTH 128 // OLED display width, in pixels
#define SCREEN_HEIGHT 64 // OLED display height, in pixels

// Declaration for an SSD1306 display connected to I2C (SDA, SCL pins)
#define OLED_RESET     -1 // Reset pin # (or -1 if sharing Arduino reset pin)
#define SCREEN_ADDRESS 0x3C ///< See datasheet for Address; 0x3D for 128x64, 0x3C for 128x32
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &I2C_screen, OLED_RESET);

FirebaseData fbdo;
FirebaseAuth auth;
FirebaseConfig config;

// Add a new variable to track the sitting status
bool isSitting = false;

// Add a debounce delay for the photoresistor readings
const unsigned long debounceDelay = 500; // Adjust the delay as needed

void setup() {
  Serial.begin(115200);

  // Set button pins as inputs with built-in pull-up resistors
  for (int i = 0; i < sizeof(buttonPins) / sizeof(buttonPins[0]); i++) {
    pinMode(buttonPins[i], INPUT_PULLUP);
  }

  // Initialize the OLED display
  I2C_screen.begin(I2C_SDA, I2C_SCL, 100000);
  if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
    Serial.println(F("SSD1306 allocation failed"));
    for (;;); // Don't proceed, loop forever
  }
  display.clearDisplay();
  display.setTextColor(WHITE);
  display.setTextSize(1);

  // Connect to the Wi-Fi network
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  Serial.print("Connecting to Wi-Fi");
  while (WiFi.status() != WL_CONNECTED) {
    Serial.print(".");
    delay(300);
  }
  Serial.println(" connected");

  /* Assign the project host */
  config.host = FIREBASE_HOST;

  /* Assign the Firebase authentication credentials */
  config.signer.tokens.legacy_token = FIREBASE_AUTH;

  /* Initialize the library with the Firebase config */
  Firebase.begin(&config, &auth);

  Serial.println("Connected to Firebase");

  testdrawstyles("1");
}

void loop() {
  // Read the photoresistor value
  int lightValue = analogRead(photoresistorPin);

  // Print the light value
  Serial.print("Light Value: ");
  Serial.println(lightValue);

  // Calculate the average light value over a short period
  const int numReadings = 10;
  int readings[numReadings];
  int readIndex = 0;
  int total = 0;

  for (int i = 0; i < numReadings; i++) {
    readings[i] = 0;
  }

  for (int i = 0; i < numReadings; i++) {
    readings[readIndex] = lightValue;
    total += readings[readIndex];
    readIndex = (readIndex + 1) % numReadings;
    delay(50);
  }

  int avgLightValue = total / numReadings;

  // Print the average light value
  Serial.print("Average Light Value: ");
  Serial.println(avgLightValue);

  if (avgLightValue >= sittingThreshold && isSitting) {
    // Someone has gotten up from the seat
    isSitting = false;
    Serial.println("Someone has gotten up from the seat!");

    // Check the current status of the seat
    String seatId = "seat1"; // Replace with the appropriate seat ID
    String seatPath = "seats/" + seatId;

    if (Firebase.getString(fbdo, seatPath + "/status")) {
      if (fbdo.stringData().equals("occupied")) {
        // Display the prompt using the testdrawstyles() function
        testdrawstyles(seatId);
      }
    } else {
      Serial.println("Failed to read seat status from Firebase");
    }

    // Add a debounce delay to stabilize the readings
    delay(debounceDelay);
  } else if (avgLightValue < sittingThreshold && !isSitting) {
    // Someone is sitting
    isSitting = true;
    Serial.println("Someone is sitting. Display cleared.");

    // Clear the display
    display.clearDisplay();
    display.display();
  }

  // Check if Button 1 is pressed
  if (digitalRead(buttonPins[0]) == LOW) {
    String seatId = "seat1"; // Replace with the appropriate seat ID
    String seatPath = "seats/" + seatId;

    if (Firebase.getString(fbdo, seatPath + "/status")) {
      if (fbdo.stringData().equals("occupied")) {
        // Update seat status to "available" in Firebase
        if (Firebase.setString(fbdo, seatPath + "/status", "available")) {
          Serial.println("Seat " + seatId + " is now available for bidding");
          display.clearDisplay();
          display.setCursor(0, 0);
          display.println("Seat " + seatId);
          display.println("Available for");
          display.println("bidding");
          display.display();
          delay(2000); // Display the confirmation for 2 seconds
        } else {
          Serial.println("Failed to update seat status in Firebase");
        }
      }
    } else {
      Serial.println("Failed to read seat status from Firebase");
    }

    // Add a debounce delay to avoid multiple button presses
    delay(500);
  }
}

void testdrawstyles(String seatId) {
  display.clearDisplay();
  Serial.println("Drawing on screen");
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.setCursor(0, 0);
  display.println("Seat vacated!");

  display.setCursor(0, 10);
  display.println("Seat: " + seatId);

  display.setCursor(0, 20);
  display.println("Make seat available?");

  display.setCursor(0, 30);
  display.println("Press Button 1");

  display.setCursor(0, 40);
  display.println("to confirm");

  display.display();

  // Wait for button press or timeout
  unsigned long startTime = millis();
  bool buttonPressed = false;
  while (millis() - startTime < 5000) { // 5-second timeout
    if (digitalRead(buttonPins[0]) == LOW) {
      buttonPressed = true;
      break;
    }

    // Check if someone sits down during the timeout period
    if (analogRead(photoresistorPin) < sittingThreshold) {
      isSitting = true;
      display.clearDisplay();
      display.display();
      return;
    }
  }

  if (buttonPressed) {
    // Update seat status to "available" in Firebase
    if (Firebase.setString(fbdo, "seats/" + seatId + "/status", "available")) {
      Serial.println("Seat " + seatId + " is now available for bidding");
      display.clearDisplay();
      display.setCursor(0, 0);
      display.println("Seat " + seatId);
      display.println("Available for");
      display.println("bidding");
      display.display();
      delay(2000); // Display the confirmation for 2 seconds
    } else {
      Serial.println("Failed to update seat status in Firebase");
    }
  } else {
    Serial.println("No button pressed. Seat " + seatId + " remains occupied");
  }
}
</code></pre>
<style>
.code-wrapper {
  max-height: 400px;
  overflow: auto;
  background-color: black;
  color: #00ff00;
  font-family: 'Consolas', monospace;
  padding: 10px;
}
</style>

<h3>HTML Code</h3> 
<pre class="code-block"><code>
    <div class="code-wrapper">

<!DOCTYPE html>
<html>
<head>
  <title>Seat Bidding App</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1lYKx+GvBkr6G4A+oPFaTxl2OgZ6OdmIKqmd6vQnQl3We+lHuCgjUy+EmDg4zPXgb0XO/fVovTDW0K44Oxd8qA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <div class="demo">
    <div class="demo__phone">
      <div class="demo__screen-wrapper">
        <div class="demo__screen">
          <div class="demo__indicator demo__indicator--time">5:30</div>
          <div class="demo__indicator demo__indicator--signal">
            <i class="fa fa-signal"></i>
          </div>
          <div class="demo__indicator demo__indicator--battery">
            <div class="battery">
              <div class="battery-level" id="battery-level"></div>
            </div>
          </div>
          <div class="demo__controls">
            <div class="demo__arrow">
              <i class="fa fa-chevron-left"></i>
            </div>
            <div class="demo__caption">Real Time Seat Bidding</div>
            <div class="demo__logo">
              <img src="https://www.usopen.org/assets/images/header/usopen-header-logo.png" alt="US Open Logo">
            </div>
          </div>
          <div class="match-info">
            <div class="match-info__court">Court: Louis Armstrong</div>
            <div class="match-info__session">Session: Men's and Women's 3rd Round</div>
            <div class="match-info__current">
              Current Match:
              <a href="https://www.atptour.com/en/players/carlos-alcaraz/a0e2/overview" class="player-link" target="_blank">C. Alcaraz [2]</a>
              vs.
              <a href="https://www.atptour.com/en/players/daniil-medvedev/mm58/overview" class="player-link" target="_blank">D. Medvedev [3]</a>
            </div>
          </div>
          <h2 class="seating-chart-title">Louis Armstrong Seating Chart</h2>
          <div class="seating-map">
            <img src="https://www.tennistours.com/img/seating-guides/us-open/Louisarmstrongmap.jpg" alt="Seating Map">
          </div>
          <div id="seats-container"></div>
        </div>
      </div>
      <div class="demo__notch"></div>
    </div>
  </div>
  <div class="developer-info">Kabir Mehta - HKS MPP 2024</div>

  <div id="seatModal" class="demo__card-modal">
    <div class="demo__card-modal-content">
      <span class="demo__card-modal-close">&times;</span>
      <h2>Place Your Bid</h2>
      <p>Enter your bid amount:</p>
      <div class="demo__card-bid-input">
        <input type="number" id="bidAmount" min="0" step="1" required>
        <button id="placeBidBtn">Place Bid</button>
      </div>
      <div class="demo__card-timer initial-timer"></div>
      <div class="demo__card-timer bidding-timer" style="display: none;"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA9hEAAx7U-2YDgoUiyy5lqnOu0fxe4A1Q",
      authDomain: "esp32-firebase-demo-for-mvp.firebaseapp.com",
      databaseURL: "https://esp32-firebase-demo-for-mvp-default-rtdb.firebaseio.com",
      projectId: "esp32-firebase-demo-for-mvp",
      storageBucket: "esp32-firebase-demo-for-mvp.appspot.com",
      messagingSenderId: "579150248970",
      appId: "1:579150248970:web:a1bb637ddb940e7b5bf3f3"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
  <script src="script.js"></script>

<div id="bidResultModal" class="demo__card-modal">
  <div class="demo__card-modal-content">
    <span class="demo__card-modal-close">&times;</span>
    <h2 id="bidResultTitle"></h2>
    <p id="bidResultMessage"></p>
    <div class="qr-code-container">
      <img id="qrCode" src="" alt="QR Code">
    </div>
    <button id="closeResultModalBtn">Close this window</button>
  </div>
</div>
</body>
</html>

</code></pre>
<style>
.code-wrapper {
  max-height: 400px;
  overflow: auto;
  background-color: black;
  color: #00ff00;
  font-family: 'Consolas', monospace;
  padding: 10px;
}
</style>

        
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            const fadeSections = document.querySelectorAll('.fade-section');
            fadeSections.forEach((section, index) => {
                const delay = index * 300;
                setTimeout(() => {
                    section.style.opacity = 1;
                }, delay);
            });
        });
    </script>
</body>
</html>
