<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Seat Bidding System</title>
    <style>
        body {
            font-family: 'Consolas', monospace;
            background-color: #f5f5dc;
            padding: 20px;
        }
        h1 {
            font-size: 24px;
            font-weight: bold;
        }
        h2 {
            font-weight: bold;
        }
        p, ul, li {
            margin: 10px 0;
        }
        em {
            font-style: italic;
        }
        .fade-section {
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }
        img {
            max-width: 300px;
            height: auto;
        }
        .code-block {
            background-color: #f4f4f4;
            padding: 10px;
            overflow-x: auto;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="fade-section">
        <h1>Real-Time Seat Bidding System</h1>
        <h2>Introduction</h2>
        <p>I developed a real-time seat bidding system that allows users to bid on available seats at a venue using their mobile devices. The project combines hardware components, such as an ESP32 C3 Dev Kit, OLED screen, push button, and photoresistor, with a user-friendly front-end webpage designed to resemble a mobile app on an iPhone. In addition, the system uses Firebase to store and synchronize real-time data on seat status, ensuring that all bids and seat availability updates are processed instantly to provide a seamless and dynamic user experience.</p>

        <img src="https://github.com/chkvly/PS70/blob/main/images/final%20product.HEIC" alt="" style="width: auto; max-height: 200px;">

        <h2>How It Works</h2>
        <ol>
            <li>A photoresistor is used to determine whether someone is sitting in a seat. When the photoresistor value falls below 800, it indicates that the seat is occupied. As soon as someone gets up from the seat and the photoresistor value rises above 800, the user is prompted via the OLED screen to make their seat available for bidding.</li>
            <li>The front-end webpage is designed as a mock-up of a real-time bidding mobile app on an iPhone, providing a user-friendly interface for the bidding process.</li>
            <li>If the user chooses to make their seat available for bidding, they press a button, which changes the seat status from "occupied" to "available for bidding." Firebase is used for storing and synchronizing real-time data on seat status.</li>
            <li>When a user seeking to bid clicks on an available seat, a confirmation modal appears.</li>
            <li>If the user confirms their intention to bid, the bid modal is displayed, allowing them to enter a bid amount. A 10-second timer is shown, indicating the time remaining to place a bid.</li>
            <li>If the user enters a bid amount greater than $0, the bidding process begins, and a 15-second bidding timer is displayed. During this time, simulated bids are generated to create a competitive bidding environment.</li>
            <li>After the bidding timer expires, the highest bid is confirmed, and the seat status is updated accordingly. The JavaScript code includes functions for displaying notifications to the user, such as when they have been outbid or when the bidding results are available.</li>
            <li>If the user wins the bid, a pop-up screen appears within the iPhone mockup, congratulating them on upgrading their seat. The user is instructed to show a QR code to a staff member to access their new seat. Scanning the QR code plays "Bullet with Butterfly Wings" by the Smashing Pumpkins.</li>
            <li>If the user is outbid, a pop-up screen informs them that they were not the highest bidder and provides the winning bid amount. The user is encouraged to scan a QR code to be notified when additional seats become available for bidding. Scanning this QR code plays George Costanza's answering machine message.</li>
        </ol>
        
        <h2>Technical Challenges and Solutions</h2>
        <h3>ESP32 Connectivity</h3>
        <p>Connectivity issues were experienced with different ESP32 models, including the ESP32 XIAO, WROOM, and C3 Dev Kit. These issues manifested as status 2 errors and port errors, indicating communication problems between the microcontroller and the development environment.</p>
        <p>Resolving these connectivity issues required persistence and a trial-and-error approach. Various troubleshooting techniques were employed, such as checking the wiring connections, ensuring the correct board selection in the Arduino IDE, and experimenting with different USB cables and ports. After numerous attempts and iterations, the ESP32 C3 Dev Kit was successfully connected and programmed.</p>
        
        <h3>OLED Screen Integration</h3>
        <p>Integrating the OLED screen with the ESP32 posed challenges in terms of controlling the on/off behavior based on the photoresistor readings. The OLED screen would turn off when the photoresistor value fell below a threshold, indicating seat occupancy, but it would not turn back on when the value rose above the threshold, signifying that the seat was vacated.</p>
        <p>To address this issue, the Arduino code was modified to include specific conditions and delays to ensure proper OLED screen functionality.</p>
        <p>The testdrawstyles function was modified to include a timeout period of 5 seconds, during which the system waits for a button press or checks if someone sits down again. If the button is pressed within the timeout period, the seat status is updated to "available" in the Firebase Realtime Database, and the OLED screen displays a confirmation message. If someone sits down during the timeout period, the OLED screen is cleared, and the function returns, keeping the seat status as "occupied."</p>
        
        <h3>PIR Sensor Considerations</h3>
        <p>Initially, a PIR sensor was considered for detecting the presence of a person in a seat. However, after experimenting with the PIR sensor, it was found to be overly sensitive and challenging to integrate with the ESP32. The PIR sensor's high sensitivity led to false triggers and inconsistent readings, making it difficult to reliably determine seat occupancy.</p>
        <p>As an alternative, a photoresistor was chosen for motion detection. The photoresistor provided a more stable and practical approach to detecting seat occupancy by measuring the ambient light level. By setting an appropriate threshold value, the system could accurately determine whether someone was sitting in a seat based on the changes in light intensity caused by their presence. The photoresistor proved to be a more reliable and easier-to-integrate solution compared to the PIR sensor.</p>
        
        <h3>Front-end Development</h3>
        <p>Developing the front-end webpage using HTML, CSS, and JavaScript required extensive trial and error to achieve the desired functionality and visual appearance. One of the main challenges was creating the pop-up boxes for placing bid amounts and displaying QR codes within the iPhone mockup. To address this, various CSS techniques were employed, such as absolute positioning, z-index layering, and responsive design principles. JavaScript code was written to dynamically create and manipulate the pop-up elements based on user interactions and bidding states.</p>
        
        <h3>Bidding Process Enhancement</h3>
        <p>To make the bidding process more engaging and realistic, effort was put into brainstorming and implementing features that would enhance the user experience. The goal was to create a sense of competition and urgency during the bidding phase.</p>
        <p>The solution involved generating randomly simulated bids within a specific time frame to determine a market-clearing price. JavaScript functions were developed to handle the simulated bids, update the seat status in real-time, and provide visual feedback to the user through the front-end interface.</p>
        
        <h2>Hardware Assembly and Enclosure</h2>
        <h3>Soldering</h3>
        <p>To ensure proper connections between the ESP32 C3 Dev Kit, OLED screen, push button, and photoresistor, precise soldering was required. Soldering the components involved carefully heating the pins and applying solder to create secure electrical connections. Proper soldering techniques, such as maintaining the correct temperature and using the appropriate amount of solder, were essential to ensure the reliability and functionality of the hardware setup.</p>
        
        <h3>3D Printed Enclosure</h3>
        <p>To protect the hardware components and provide a professional appearance, a custom enclosure was designed and 3D printed. The enclosure was obtained from Printables and modified using a heat gun to enlarge the holes for the wires. The 3D printed enclosure not only added aesthetic value to the project but also ensured the safe and secure housing of the components.</p>
        
        <h2>Concluding Remarks</h2>
        <p>The real-time seat bidding system showcases the integration of hardware components with a user-friendly front-end webpage to create an interactive and engaging bidding experience. By leveraging the capabilities of the ESP32 and Firebase Realtime Database, the system enables seamless communication between the physical world and the digital interface. Moreover, the project demonstrates the potential of real-time bidding systems in enhancing the user experience and maximizing revenue opportunities in event settings. With further refinement and scaling, this proof of concept could be adapted to real-world applications, revolutionizing the way people upgrade their seats and engage with live events.</p>

<h2>Code</h2> 
<h3>Arduino Code</h3> 
<pre class="code-block"><code>
    <div class="code-wrapper">

#include WiFi.h
#include FirebaseESP32.h
#include Wire.h
#include Adafruit_GFX.h
#include Adafruit_SSD1306.h

// Replace these with your Wi-Fi network settings
#define WIFI_SSID " "
#define WIFI_PASSWORD " "

// Firebase project credentials
#define FIREBASE_HOST " "
#define FIREBASE_AUTH " "

// Define the GPIO pins for the buttons (ESP32-C3 pins)
const int buttonPins[] = {18, 1, 2, 3};
const String seatIds[] = {"seat1", "seat2", "seat3", "seat4"};

// Define the analog pin for the photoresistor
const int photoresistorPin = A0;

// Define the threshold value for detecting if someone is sitting or has gotten up
const int sittingThreshold = 800;

#define I2C_SDA 4  // Use GPIO 4 for I2C SDA
#define I2C_SCL 5  // Use GPIO 5 for I2C SCL

TwoWire I2C_screen = TwoWire(0);

#define SCREEN_WIDTH 128 // OLED display width, in pixels
#define SCREEN_HEIGHT 64 // OLED display height, in pixels

// Declaration for an SSD1306 display connected to I2C (SDA, SCL pins)
#define OLED_RESET     -1 // Reset pin # (or -1 if sharing Arduino reset pin)
#define SCREEN_ADDRESS 0x3C ///< See datasheet for Address; 0x3D for 128x64, 0x3C for 128x32
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &I2C_screen, OLED_RESET);

FirebaseData fbdo;
FirebaseAuth auth;
FirebaseConfig config;

// Add a new variable to track the sitting status
bool isSitting = false;

// Add a debounce delay for the photoresistor readings
const unsigned long debounceDelay = 500; // Adjust the delay as needed

void setup() {
  Serial.begin(115200);

  // Set button pins as inputs with built-in pull-up resistors
  for (int i = 0; i < sizeof(buttonPins) / sizeof(buttonPins[0]); i++) {
    pinMode(buttonPins[i], INPUT_PULLUP);
  }

  // Initialize the OLED display
  I2C_screen.begin(I2C_SDA, I2C_SCL, 100000);
  if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
    Serial.println(F("SSD1306 allocation failed"));
    for (;;); // Don't proceed, loop forever
  }
  display.clearDisplay();
  display.setTextColor(WHITE);
  display.setTextSize(1);

  // Connect to the Wi-Fi network
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  Serial.print("Connecting to Wi-Fi");
  while (WiFi.status() != WL_CONNECTED) {
    Serial.print(".");
    delay(300);
  }
  Serial.println(" connected");

  /* Assign the project host */
  config.host = FIREBASE_HOST;

  /* Assign the Firebase authentication credentials */
  config.signer.tokens.legacy_token = FIREBASE_AUTH;

  /* Initialize the library with the Firebase config */
  Firebase.begin(&config, &auth);

  Serial.println("Connected to Firebase");

  testdrawstyles("1");
}

void loop() {
  // Read the photoresistor value
  int lightValue = analogRead(photoresistorPin);

  // Print the light value
  Serial.print("Light Value: ");
  Serial.println(lightValue);

  // Calculate the average light value over a short period
  const int numReadings = 10;
  int readings[numReadings];
  int readIndex = 0;
  int total = 0;

  for (int i = 0; i < numReadings; i++) {
    readings[i] = 0;
  }

  for (int i = 0; i < numReadings; i++) {
    readings[readIndex] = lightValue;
    total += readings[readIndex];
    readIndex = (readIndex + 1) % numReadings;
    delay(50);
  }

  int avgLightValue = total / numReadings;

  // Print the average light value
  Serial.print("Average Light Value: ");
  Serial.println(avgLightValue);

  if (avgLightValue >= sittingThreshold && isSitting) {
    // Someone has gotten up from the seat
    isSitting = false;
    Serial.println("Someone has gotten up from the seat!");

    // Check the current status of the seat
    String seatId = "seat1"; // Replace with the appropriate seat ID
    String seatPath = "seats/" + seatId;

    if (Firebase.getString(fbdo, seatPath + "/status")) {
      if (fbdo.stringData().equals("occupied")) {
        // Display the prompt using the testdrawstyles() function
        testdrawstyles(seatId);
      }
    } else {
      Serial.println("Failed to read seat status from Firebase");
    }

    // Add a debounce delay to stabilize the readings
    delay(debounceDelay);
  } else if (avgLightValue < sittingThreshold && !isSitting) {
    // Someone is sitting
    isSitting = true;
    Serial.println("Someone is sitting. Display cleared.");

    // Clear the display
    display.clearDisplay();
    display.display();
  }

  // Check if Button 1 is pressed
  if (digitalRead(buttonPins[0]) == LOW) {
    String seatId = "seat1"; // Replace with the appropriate seat ID
    String seatPath = "seats/" + seatId;

    if (Firebase.getString(fbdo, seatPath + "/status")) {
      if (fbdo.stringData().equals("occupied")) {
        // Update seat status to "available" in Firebase
        if (Firebase.setString(fbdo, seatPath + "/status", "available")) {
          Serial.println("Seat " + seatId + " is now available for bidding");
          display.clearDisplay();
          display.setCursor(0, 0);
          display.println("Seat " + seatId);
          display.println("Available for");
          display.println("bidding");
          display.display();
          delay(2000); // Display the confirmation for 2 seconds
        } else {
          Serial.println("Failed to update seat status in Firebase");
        }
      }
    } else {
      Serial.println("Failed to read seat status from Firebase");
    }

    // Add a debounce delay to avoid multiple button presses
    delay(500);
  }
}

void testdrawstyles(String seatId) {
  display.clearDisplay();
  Serial.println("Drawing on screen");
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.setCursor(0, 0);
  display.println("Seat vacated!");

  display.setCursor(0, 10);
  display.println("Seat: " + seatId);

  display.setCursor(0, 20);
  display.println("Make seat available?");

  display.setCursor(0, 30);
  display.println("Press Button 1");

  display.setCursor(0, 40);
  display.println("to confirm");

  display.display();

  // Wait for button press or timeout
  unsigned long startTime = millis();
  bool buttonPressed = false;
  while (millis() - startTime < 5000) { // 5-second timeout
    if (digitalRead(buttonPins[0]) == LOW) {
      buttonPressed = true;
      break;
    }

    // Check if someone sits down during the timeout period
    if (analogRead(photoresistorPin) < sittingThreshold) {
      isSitting = true;
      display.clearDisplay();
      display.display();
      return;
    }
  }

  if (buttonPressed) {
    // Update seat status to "available" in Firebase
    if (Firebase.setString(fbdo, "seats/" + seatId + "/status", "available")) {
      Serial.println("Seat " + seatId + " is now available for bidding");
      display.clearDisplay();
      display.setCursor(0, 0);
      display.println("Seat " + seatId);
      display.println("Available for");
      display.println("bidding");
      display.display();
      delay(2000); // Display the confirmation for 2 seconds
    } else {
      Serial.println("Failed to update seat status in Firebase");
    }
  } else {
    Serial.println("No button pressed. Seat " + seatId + " remains occupied");
  }
}
</code></pre>
<style>
.code-wrapper {
  max-height: 400px;
  overflow: auto;
  background-color: black;
  color: #00ff00;
  font-family: 'Consolas', monospace;
  padding: 10px;
}
</style>

<h3>HTML Code</h3> 
<pre class="code-block"><code>
    <div class="code-wrapper">

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Seat Bidding App&lt;/title&gt;
  &lt;link rel="stylesheet" type="text/css" href="style.css"&gt;
  &lt;link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet"&gt;
  &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1lYKx+GvBkr6G4A+oPFaTxl2OgZ6OdmIKqmd6vQnQl3We+lHuCgjUy+EmDg4zPXgb0XO/fVovTDW0K44Oxd8qA==" crossorigin="anonymous" referrerpolicy="no-referrer" /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="demo"&gt;
    &lt;div class="demo__phone"&gt;
      &lt;div class="demo__screen-wrapper"&gt;
        &lt;div class="demo__screen"&gt;
          &lt;div class="demo__indicator demo__indicator--time"&gt;5:30&lt;/div&gt;
          &lt;div class="demo__indicator demo__indicator--signal"&gt;
            &lt;i class="fa fa-signal"&gt;&lt;/i&gt;
          &lt;/div&gt;
          &lt;div class="demo__indicator demo__indicator--battery"&gt;
            &lt;div class="battery"&gt;
              &lt;div class="battery-level" id="battery-level"&gt;&lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;div class="demo__controls"&gt;
            &lt;div class="demo__arrow"&gt;
              &lt;i class="fa fa-chevron-left"&gt;&lt;/i&gt;
            &lt;/div&gt;
            &lt;div class="demo__caption"&gt;Real Time Seat Bidding&lt;/div&gt;
            &lt;div class="demo__logo"&gt;
              &lt;img src="https://www.usopen.org/assets/images/header/usopen-header-logo.png" alt="US Open Logo"&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;div class="match-info"&gt;
            &lt;div class="match-info__court"&gt;Court: Louis Armstrong&lt;/div&gt;
            &lt;div class="match-info__session"&gt;Session: Men's and Women's 3rd Round&lt;/div&gt;
            &lt;div class="match-info__current"&gt;
              Current Match:
              &lt;a href="https://www.atptour.com/en/players/carlos-alcaraz/a0e2/overview" class="player-link" target="_blank"&gt;C. Alcaraz [2]&lt;/a&gt;
              vs.
              &lt;a href="https://www.atptour.com/en/players/daniil-medvedev/mm58/overview" class="player-link" target="_blank"&gt;D. Medvedev [3]&lt;/a&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;h2 class="seating-chart-title"&gt;Louis Armstrong Seating Chart&lt;/h2&gt;
          &lt;div class="seating-map"&gt;
            &lt;img src="https://www.tennistours.com/img/seating-guides/us-open/Louisarmstrongmap.jpg" alt="Seating Map"&gt;
          &lt;/div&gt;
          &lt;div id="seats-container"&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="demo__notch"&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class="developer-info"&gt;Kabir Mehta - HKS MPP 2024&lt;/div&gt;

  &lt;div id="seatModal" class="demo__card-modal"&gt;
    &lt;div class="demo__card-modal-content"&gt;
      &lt;span class="demo__card-modal-close"&gt;&amp;times;&lt;/span&gt;
      &lt;h2&gt;Place Your Bid&lt;/h2&gt;
      &lt;p&gt;Enter your bid amount:&lt;/p&gt;
      &lt;div class="demo__card-bid-input"&gt;
        &lt;input type="number" id="bidAmount" min="0" step="1" required&gt;
        &lt;button id="placeBidBtn"&gt;Place Bid&lt;/button&gt;
      &lt;/div&gt;
      &lt;div class="demo__card-timer initial-timer"&gt;&lt;/div&gt;
      &lt;div class="demo__card-timer bidding-timer" style="display: none;"&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"&gt;&lt;/script&gt;
  &lt;script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"&gt;&lt;/script&gt;
  &lt;script&gt;
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: " ",
      authDomain: " ",
      databaseURL: " ",
      projectId: " ",
      storageBucket: " ",
      messagingSenderId: " ",
      appId: " "
    };
    firebase.initializeApp(firebaseConfig);
  &lt;/script&gt;
  &lt;script src="script.js"&gt;&lt;/script&gt;

&lt;div id="bidResultModal" class="demo__card-modal"&gt;
  &lt;div class="demo__card-modal-content"&gt;
    &lt;span class="demo__card-modal-close"&gt;&amp;times;&lt;/span&gt;
    &lt;h2 id="bidResultTitle"&gt;&lt;/h2&gt;
    &lt;p id="bidResultMessage"&gt;&lt;/p&gt;
    &lt;div class="qr-code-container"&gt;
      &lt;img id="qrCode" src="" alt="QR Code"&gt;
    &lt;/div&gt;
    &lt;button id="closeResultModalBtn"&gt;Close this window&lt;/button&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre>
<style>
.code-wrapper {
  max-height: 400px;
  overflow: auto;
  background-color: black;
  color: #00ff00;
  font-family: 'Consolas', monospace;
  padding: 10px;
}
</style>

<h3>CSS Code</h3> 
<pre class="code-block"><code>
    <div class="code-wrapper">

/* Reset styles */
*, *:before, *:after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Source Sans Pro', monospace;
  background-color: #f5deb3;
}

.demo {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.demo__phone {
  position: relative;
  width: 375px;
  height: 812px;
  background-color: #120d30;
  border-radius: 40px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  overflow: hidden;
}

.demo__screen-wrapper {
  position: absolute;
  top: 20px;
  left: 20px;
  right: 20px;
  bottom: 20px;
  background-color: #fff;
  border-radius: 30px;
  overflow: hidden;
}

.demo__screen {
  position: relative;
  height: 100%;
  overflow-y: auto;
  padding: 20px;
}

.demo__indicator {
  position: absolute;
  font-size: 16px;
  color: #120d30;
}

.demo__indicator--time {
  left: 30px;
  top: 22px;
}

.demo__indicator--signal {
  right: 60px;
}

.demo__controls {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 60px;
  color: #000;
  top: 60px;
  position: absolute;
  width: 100%;
}

.demo__arrow {
  position: absolute;
  left: 20px;
  font-size: 20px;
}

.demo__caption {
  font-size: 20px;
  font-weight: 700;
  position: relative;
  top: -41px;
    transform: translateX(-3.5%);
  text-align: center;
  width: 100%;
}

.demo__notch {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  height: 30px;
  background-color: #120d30;
  border-radius: 0 0 20px 20px;
}

.demo__card {
  position: relative;
  margin: 20px;
  height: 90px;
  font-size: 24px;
  border-radius: 10px;
  background-color: white;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  text-align: center;
  cursor: pointer;
}

.demo__card-frontside {
  position: absolute;
  top: 0;
  width: 100%;
  height: 100%;
  padding: 10px;
}

.demo__card-caption {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 5px;
}

.demo__card-description {
  font-size: 14px;
  color: #666;
}

.seat-sold {
  background-color: #8b0000;
  color: #fff;
}

.seat-bidding {
  font-weight: bold;
}

.seat-available {
  background-color: #00ff00;
}

.seat-occupied {
  background-color: #ccc;
}

.match-info {
  margin-bottom: 70px;
  text-align: center;
  position: relative;
  top: 45px;
}

.match-info__court,
.match-info__session,
.match-info__current {
  margin-bottom: 3px;
}

.seating-chart-title {
  margin-top: 20px;
  margin-bottom: 10px;
  text-align: center;
  font-size: 18px;
}

.seating-map {
  position: relative;
  width: 100%;
  height: auto;
  margin-bottom: 20px;
}

.seating-map img {
  width: 100%;
  height: auto;
}

.seat-bidding {
  background-color: #ffd700;
  font-weight: bold;
}

.developer-info {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 14px;
  color: #666;
  text-align: center;
}

.player-link {
  color: blue;
  text-decoration: underline;
  cursor: pointer;
}

.player-link:hover {
  color: darkblue;
}

.developer-info {
  position: fixed;
  bottom: 23px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  color: #666;
  text-align: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.demo__card-modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4);
}

.demo__card-modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  max-width: 320px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

.demo__card-modal-close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.demo__card-modal-close:hover,
.demo__card-modal-close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.demo__card-bid-input {
  margin-top: 10px;
}

.demo__card-timer {
  margin-top: 10px;
  font-weight: bold;
}

.confirm-modal {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  padding: 20px;
  border: 1px solid #ccc;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  z-index: 2;
  width: 80%;
  max-width: 320px;
  text-align: center;
}

.confirm-buttons {
  display: flex;
  justify-content: space-around;
  margin-top: 20px;
}

.confirm-buttons button {
  padding: 8px 16px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.qr-code-container {
  margin-top: 20px;
}

#qrCode {
  width: 200px;
  height: 200px;
}

#closeResultModalBtn {
  margin-top: 20px;
  padding: 8px 16px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.demo__logo {
  position: absolute;
  top: calc(100% + 5px)
  left: 50%;
  transform: translateX(-28%);
  margin-top: -112px;
}

.demo__logo img {
  width: 100px;
  height: auto;
}

</code></pre>
<style>
.code-wrapper {
  max-height: 400px;
  overflow: auto;
  background-color: black;
  color: #00ff00;
  font-family: 'Consolas', monospace;
  padding: 10px;
}
</style>

        <h3>JavaScript Code</h3> 
<pre class="code-block"><code>
    <div class="code-wrapper">

// Get the modal element
const seatModal = document.getElementById('seatModal');

// Get the close button element
const closeBtn = document.querySelector('.demo__card-modal-close');

// Get the place bid button element
const placeBidBtn = document.getElementById('placeBidBtn');

// Get the bid amount input field
const bidAmountInput = document.getElementById('bidAmount');

// Get the bid input container
const bidInputContainer = document.querySelector('.demo__card-bid-input');

// Get the initial timer element
const initialTimerElement = document.querySelector('.demo__card-timer.initial-timer');

// Get the bidding timer element
const biddingTimerElement = document.querySelector('.demo__card-timer.bidding-timer');

// Get a reference to the seats container
const seatsContainer = document.getElementById('seats-container');

// Reference to the Firebase Realtime Database
const database = firebase.database();

// Function to create a seat element
function createSeatElement(seatId, seatData) {
  const seatCard = document.createElement('div');
  seatCard.classList.add('demo__card', 'seat-card');
  seatCard.setAttribute('data-seat-id', seatId);

  const seatFrontside = document.createElement('div');
  seatFrontside.classList.add('demo__card-frontside');

  const seatCaption = document.createElement('div');
  seatCaption.classList.add('demo__card-caption');

  const seatDescription = document.createElement('div');
  seatDescription.classList.add('demo__card-description');
  seatDescription.textContent = 'Tap to place a bid';

  if (seatData.status === 'sold') {
    seatCard.classList.add('seat-sold');
    seatCaption.textContent = `Seat ${seatId} - Sold`;
  } else if (seatData.status === 'bidding') {
    seatCard.classList.add('seat-bidding');
    seatCaption.textContent = `Seat ${seatId} - Bidding: $${seatData.bidAmount}`;
  } else if (seatData.status === 'available') {
    seatCard.classList.add('seat-available');
    seatCaption.textContent = `Seat ${seatId} - Available`;
  } else if (seatData.status === 'occupied') {
    seatCard.classList.add('seat-occupied');
    seatCaption.textContent = `Seat ${seatId} - Occupied`;
    seatDescription.style.display = 'none';
  }

  seatFrontside.appendChild(seatCaption);
  seatFrontside.appendChild(seatDescription);

  seatCard.appendChild(seatFrontside);

  seatCard.addEventListener('click', () => {
    handleSeatClick(seatId);
  });

  return seatCard;
}

function handleSeatClick(seatId) {
  const seatRef = database.ref('seats/' + seatId);
  const seatCard = document.querySelector(`.seat-card[data-seat-id="${seatId}"]`);

  seatRef.once('value', snapshot => {
    const seatData = snapshot.val();
    const seatStatus = seatData.status;

    if (seatStatus === 'available') {
      // Show the confirmation modal
      const confirmModal = document.createElement('div');
      confirmModal.classList.add('confirm-modal');

      const confirmText = document.createElement('p');
      confirmText.textContent = 'You will have 10 seconds to place a bid. After placing a bid, the market-clearing price will be determined based on demand for the seat. Do you wish to proceed?';

      const confirmButtons = document.createElement('div');
      confirmButtons.classList.add('confirm-buttons');

      const confirmNo = document.createElement('button');
      confirmNo.textContent = 'No';
      confirmNo.addEventListener('click', () => {
        confirmModal.remove();
      });

      const confirmYes = document.createElement('button');
      confirmYes.textContent = 'Yes';
      confirmYes.addEventListener('click', () => {
        confirmModal.remove();
        showBidModal(seatId, seatRef);
      });

      confirmButtons.appendChild(confirmNo);
      confirmButtons.appendChild(confirmYes);

      confirmModal.appendChild(confirmText);
      confirmModal.appendChild(confirmButtons);

      document.body.appendChild(confirmModal);
    } else {
      console.log('Seat is not available for bidding');
    }
  });
}

// Function to show the bid modal with the two timers
function showBidModal(seatId, seatRef) {
  // Show the bid modal
  seatModal.style.display = 'block';

  // Focus the input field immediately
  bidAmountInput.focus();

  // Close the modal when the close button is clicked
  closeBtn.onclick = function() {
    seatModal.style.display = 'none';
  }

  // Close the modal when clicked outside the modal content
  window.onclick = function(event) {
    if (event.target == seatModal) {
      seatModal.style.display = 'none';
    }
  }

  // Start the initial timer
  let initialTimeLeft = 10; // 10 seconds to place the initial bid
  initialTimerElement.textContent = initialTimeLeft;
  const initialTimerInterval = setInterval(() => {
    initialTimeLeft--;
    initialTimerElement.textContent = initialTimeLeft;

    if (initialTimeLeft === 0) {
      clearInterval(initialTimerInterval);
      // Show the bid input container and start the bidding timer
      bidInputContainer.style.display = 'block';
      startBiddingTimer(seatId, seatRef);
    }
  }, 1000);

  // Handle place bid button click
  placeBidBtn.onclick = function() {
    const bidAmount = bidAmountInput.value;

    if (bidAmount !== '') {
      const bidAmountNumber = parseFloat(bidAmount);

      if (bidAmountNumber > 0) {
        seatRef.update({
          status: 'bidding',
          bidAmount: bidAmountNumber
        })
        .then(() => {
          console.log('Bid placed successfully');
        })
        .catch(error => {
          console.error('Error placing bid:', error);
        });
      } else {
        // Display an error message or notification
        console.error('Bid amount must be greater than $0');
      }
    }
  }
}

// Function to start the bidding timer
function startBiddingTimer(seatId, seatRef) {
  const bidAmountNumber = parseFloat(bidAmountInput.value);
  if (bidAmountNumber >= 1) {
    biddingTimerElement.style.display = 'block';
    let timeLeft = 10;
    biddingTimerElement.textContent = `Bidding Time: ${timeLeft} seconds`;
    const timerInterval = setInterval(() => {
      timeLeft--;
      biddingTimerElement.textContent = `Bidding Time: ${timeLeft} seconds`;

      // Simulate other users placing bids
      simulateOtherUserBids(seatId, seatRef, bidAmountNumber);

      if (timeLeft === 0) {
        clearInterval(timerInterval);
        // Confirm the highest bid and update the seat status
        confirmHighestBid(seatId, seatRef, bidAmountNumber);
        seatModal.style.display = 'none';
      }
    }, 1000);
  } else {
    console.error('Bid amount must be at least $200');
  }
}

// Listen for changes in seat status
database.ref('seats').on('value', snapshot => {
  // Clear the seats container
  seatsContainer.innerHTML = '';

  snapshot.forEach(seatSnapshot => {
    const seatId = seatSnapshot.key;
    const seatData = seatSnapshot.val();

    // Create a seat element and append it to the seats container
    const seatElement = createSeatElement(seatId, seatData);
    seatsContainer.appendChild(seatElement);
  });
});

// Function to handle seat hover
function handleSeatHover(seatId) {
  const seatCard = document.querySelector(`.seat-card[data-seat-id="${seatId}"]`);
  seatCard.classList.add('active');
}

// Function to handle seat hover out
function handleSeatHoverOut(seatId) {
  const seatCard = document.querySelector(`.seat-card[data-seat-id="${seatId}"]`);
  seatCard.classList.remove('active');
}

// Add event listeners to seat map areas
const seatMapAreas = document.querySelectorAll('area[data-seat-id]');
seatMapAreas.forEach(area => {
  const seatId = area.getAttribute('data-seat-id');
  area.addEventListener('mouseover', () => handleSeatHover(seatId));
  area.addEventListener('mouseout', () => handleSeatHoverOut(seatId));
});

// Get the developer info element
const developerInfo = document.querySelector('.developer-info');

// Get the screen element
const screen = document.querySelector('.demo__screen');

// Add an event listener for scroll
screen.addEventListener('scroll', () => {
  // Calculate the scrollable height
  const scrollableHeight = screen.scrollHeight - screen.clientHeight;

  // Check if the user has scrolled to the bottom
  if (screen.scrollTop >= scrollableHeight) {
    // Show the developer info element
    developerInfo.style.opacity = '1';
  } else {
    // Hide the developer info element
    developerInfo.style.opacity = '0';
  }
});

// Function to simulate other users placing bids
function simulateOtherUserBids(seatId, seatRef, userBidAmount) {
  // Generate a random bid amount (e.g., between 200 and 500)
  const randomBidAmount = Math.floor(Math.random() * 301) + 200;

  // Update the seat status with the simulated bid amount if it's higher than the user's bid
  if (randomBidAmount > userBidAmount) {
    seatRef.update({
      status: 'bidding',
      bidAmount: randomBidAmount
    })
    .then(() => {
      console.log(`Simulated bid of $${randomBidAmount} placed on seat ${seatId}`);
      // Check if the user has been outbid and display a notification
      checkUserOutbid(seatId, randomBidAmount);
    })
    .catch(error => {
      console.error('Error simulating bid:', error);
    });
  }
}

// Function to check if the user has been outbid and display a notification
function checkUserOutbid(seatId, highestBidAmount) {
  const seatCard = document.querySelector(`.seat-card[data-seat-id="${seatId}"]`);
  const userBidInput = seatCard.querySelector('.demo__card-bid-input input');
  const userBidAmount = parseFloat(userBidInput.value);

  if (userBidAmount < highestBidAmount) {
    // Display a notification or prompt for the user to place a higher bid
    const outbidNotification = document.createElement('div');
    outbidNotification.classList.add('outbid-notification');

    const notificationText = document.createElement('p');
    notificationText.textContent = `You have been outbid! The highest bid is now $${highestBidAmount}. Do you want to place a higher bid?`;

    const confirmButton = document.createElement('button');
    confirmButton.textContent = 'Yes, Place Higher Bid';
    confirmButton.addEventListener('click', () => {
      userBidInput.focus();
      outbidNotification.style.display = 'none';
    });

    const cancelButton = document.createElement('button');
    cancelButton.textContent = 'No, Forfeit Seat';
    cancelButton.addEventListener('click', () => {
      console.log(`User forfeited seat ${seatId}`);
      outbidNotification.style.display = 'none';
    });

    outbidNotification.appendChild(notificationText);
    outbidNotification.appendChild(confirmButton);
    outbidNotification.appendChild(cancelButton);

    document.body.appendChild(outbidNotification);
    outbidNotification.style.display = 'block';
  }
}

// Function to confirm the highest bid and update the seat status
function confirmHighestBid(seatId, seatRef, userBidAmount) {
  seatRef.once('value', snapshot => {
    const seatData = snapshot.val();
    const highestBidAmount = seatData.bidAmount;

     if (parseFloat(userBidAmount) >= highestBidAmount) {
      // User has the highest bid, mark the seat as "Sold"
      seatRef.update({
        status: 'sold',
        bidAmount: parseFloat(userBidAmount)
      })
      .then(() => {
        console.log(`Seat ${seatId} sold for $${userBidAmount}`);
        bidResultTitle.textContent = 'Congratulations!';
        bidResultMessage.textContent = 'You\'ve upgraded your seat. To access your seat, please show the below QR code to a US Open staff member nearest to your new seat.';
        qrCode.src = '/Users/kabir/Documents/Harvard/Spring 2024/Fabrication/MVP/images/Untitled.jpeg'; // Replace with the actual path to your QR code image
        bidResultModal.style.display = 'block';
      })
      .catch(error => {
        console.error('Error selling seat:', error);
      });
    } else {
      // User did not have the highest bid, mark the seat as "Available" again
      seatRef.update({
        status: 'available',
        bidAmount: null
      })
      .then(() => {
        console.log(`Seat ${seatId} marked as available again`);
        bidResultTitle.textContent = 'Unfortunately, you were not the highest bidder.';
        bidResultMessage.textContent = `The seat was sold for $${highestBidAmount}. Additional seats are likely to become available. If you would like to be notified when a seat becomes available for bidding, please scan the below QR code.`;
        qrCode.src = '/Users/kabir/Documents/Harvard/Spring 2024/Fabrication/MVP/images/Untitled(1).jpeg'; // Replace with the actual path to your QR code image
        bidResultModal.style.display = 'block';
      })
      .catch(error => {
        console.error('Error updating seat status:', error);
      });
    }

    closeResultModalBtn.onclick = function() {
      bidResultModal.style.display = 'none';
    }
  });
}
</code></pre>
<style>
.code-wrapper {
  max-height: 400px;
  overflow: auto;
  background-color: black;
  color: #00ff00;
  font-family: 'Consolas', monospace;
  padding: 10px;
}
</style>

        
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            const fadeSections = document.querySelectorAll('.fade-section');
            fadeSections.forEach((section, index) => {
                const delay = index * 300;
                setTimeout(() => {
                    section.style.opacity = 1;
                }, delay);
            });
        });
    </script>
</body>
</html>
